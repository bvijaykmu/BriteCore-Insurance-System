nginx:
    image: nginx:1.13.8
    ports:
        - "80:80"
    links:
        - "backend"
        - "frontend"
    volumes:
        - "./frontend/dist:/var/www/frontend"
        - "./frontend/package-lock.json:/usr/src/app/package-lock.json"
        - "./nginx.conf:/etc/nginx/nginx.conf"
        - "./uwsgi_params:/etc/nginx/uwsgi_params"

frontend:
    volumes:
        - "./frontend/dist:/usr/src/app/dist"
    links:
        - "backend"
    command: npm run build

backend:
    ports:
        - "8000:8000"
    links:
        - "mysql"
    command:  bash -c "python3 manage.py migrate && uwsgi --http :8000 --module backend.wsgi"

mysql:
    image: mysql:5.7
    environment:
        - MYSQL_ALLOW_EMPTY_PASSWORD=1
        - MYSQL_DATABASE=britecore_insurance_system
    restart: always
    volumes:
        - "./volumes/mysql:/var/lib/mysql"
