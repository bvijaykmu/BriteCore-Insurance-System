backend:
  command: 'bash -c "python3 manage.py migrate && uwsgi --http :8000 --module backend.wsgi"'
  image: 'geovanecomp/britecorebackend:latest'
  links:
    - mysql
  ports:
    - '8000:8000'
frontend:
  command: npm run build
  image: 'geovanecomp/britecorefrontend:latest'
  links:
    - backend
  volumes:
    - '/var/www/frontend/dist:/usr/src/app/dist'
mysql:
  environment:
    - MYSQL_ALLOW_EMPTY_PASSWORD=1
    - MYSQL_DATABASE=britecore_insurance_system
  image: 'mysql:5.7'
  restart: always
  volumes:
    - '/var/lib/mysql:/var/lib/mysql'
nginx:
  image: 'nginx:1.13.8'
  links:
    - backend
    - frontend
  ports:
    - '80:80'
  volumes:
    - '/var/www/frontend/dist:/var/www/frontend'
    - '/var/www/frontend/package-lock.json:/usr/src/app/package-lock.json'
    - '/var/www/nginx.conf:/etc/nginx/nginx.conf'
    - '/var/www/uwsgi_params:/etc/nginx/uwsgi_params'
